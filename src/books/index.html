<head>
    <meta name="amp-script-src" content="sha384-wr2RmtBQ05vkX6uDyViwOKhd_80yf24HFqabRh8M5VBCsrddzqTAindqhb0H60zo">
    <script async custom-element="amp-script" src="https://cdn.ampproject.org/v0/amp-script-0.1.js"></script>
</head>
<main>
    <h1>📚 Books</h1>
    <amp-script layout="container" script="search">
        <input type="search" id="search-input" placeholder="Type to search" style="
            display: inline;
            margin-right: 10px;
        ">
        <button id="search-button" style="
            background: none;
            border: none;
        ">🔍
        </button>
        <div id="search-results"></div>
    </amp-script>
    <script id="search" type="text/plain" target="amp-script">
    import('https://cdn.skypack.dev/algoliasearch').then((module) => {
      const algoliasearch = module.default;
      const client = algoliasearch("IK2G3QGL59", "228126acea5bd276469e9549fb22b5bd");
      const index = client.initIndex("Book");
      const searchInput = document.querySelector("#search-input");
      const searchButton = document.querySelector("#search-button");
      searchButton.addEventListener("click", onInput);
      async function onInput(event) {
        const previousSearchResults = document.querySelector("#search-results");
        const newSearchResults = document.createElement("div");
        newSearchResults.setAttribute("id", "search-results");
        if (searchInput.value.length > 0) {
          const results = (await index.search(searchInput.value)).hits;
          results.forEach(result => {
              const item = document.createElement("div");
              item.classList.add("card");
              const img = document.createElement("amp-img");
              img.setAttribute("src", result.cover);
              img.setAttribute("width", 200);
              img.setAttribute("height", 280);
              img.setAttribute("layout", 'intrinsic');
              item.appendChild(img);
              const label = document.createElement("div");
              label.classList.add("container");
              let text = result.title;
              if (text.length > 50) {
                text = text.substring(0, 50) + '...';
              }
              label.textContent = text;
              item.appendChild(label);

              newSearchResults.appendChild(item);
          });
        }
        document.body.replaceChild(newSearchResults, previousSearchResults);
      }
    });



    </script>
</main>
