<!-- 
title: archUnit
date: 2020-12-01T22:43:36+09:00
draft: false
description: description
-->
# ArchUnit

![hero-img](https://res.cloudinary.com/silverbirder/image/upload/v1588513402/micro-frontends-sample-code/micro_frontends_sample.jpg)

[https://www.archunit.org/:embed:cite]

> ArchUnit is a free, simple and extensible library for checking the architecture of your Java code using any plain Java unit test framework. That is, ArchUnit can check dependencies between packages and classes, layers and slices, check for cyclic dependencies and more. It does so by analyzing given Java bytecode, importing all classes into a Java code structure.

It is a library that allows you to test the Java architecture, including packages, classes, layers, and slices (?). So I want to test this diagram, which I've seen more than my parents' faces.
So I would like to test this diagram, which I have seen more than my parents' faces.

[https://blog.cleancoder.com/uncle-bob/images/2012-08-13-the-clean-architecture/CleanArchitecture.jpg:image=https://blog.cleancoder.com/uncle-bob/images/2012-08-13-the-clean-architecture/CleanArchitecture.jpg]
â€» [https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html]

# Do ArchUnit in Typescript too

ArchUnit is made in Java. I want to do an ArchUnit for Typescript.
So I found a library that looks good.

[https://github.com/MaibornWolff/ts-arch:embed:cite]

I'm not particular about it, I think anything is fine as long as it can test the architecture.
In extreme cases, if you can parse the source code AST and extract the dependencies, I think you can make your own.

# Try

The source code we tried is available below. Please refer to it.

[https://github.com/Silver-birder/try-archunit:embed:cite]

The entire source code tree consists of the following.

<amp-gist data-gistid="62edd06ce99c5f9c141419b8516a3ecc" data-file="tree.txt" layout="fixed-height" height="100"></amp-gist>

Each product code is assumed to be just importing the files in the lower level.

<amp-gist data-gistid="62edd06ce99c5f9c141419b8516a3ecc" data-file="Web.ts" layout="fixed-height" height="100"></amp-gist>

<amp-gist data-gistid="62edd06ce99c5f9c141419b8516a3ecc" data-file="before_Controller.ts" layout="fixed-height" height="100"></amp-gist>

<amp-gist data-gistid="62edd06ce99c5f9c141419b8516a3ecc" data-file="UseCase.ts" layout="fixed-height" height="100"></amp-gist>

<amp-gist data-gistid="62edd06ce99c5f9c141419b8516a3ecc" data-file="Entity.ts" layout="fixed-height" height="100"></amp-gist>

The UML component diagram in the following file shows the dependencies.

<amp-gist data-gistid="62edd06ce99c5f9c141419b8516a3ecc" data-file="clean_architecture.puml" layout="fixed-height" height="100"></amp-gist>

The UML visualization is shown in the figure below.

<figure class="figure-image figure-image-fotolife" title="clean_architecture.puml">[f:id:silverbirder180:20201128114839p:plain]<figcaption>clean_architecture.puml</figcaption></figure>

The test code is shown below.

<amp-gist data-gistid="62edd06ce99c5f9c141419b8516a3ecc" data-file="clean_architecture.test.ts" layout="fixed-height" height="100"></amp-gist>

This test case will PASS.
<figure class="figure-image figure-image-fotolife" title="src/clean_architecture.test.ts &gt; architecture &gt; Check dependency #Succeed">[f:id:silverbirder180:20201128115326p:plain]<figcaption>src/clean_architecture.test.ts &gt; architecture &gt; Check dependency #Succeed</figcaption></figure>

Now let's try to write the offending code.

<amp-gist data-gistid="62edd06ce99c5f9c141419b8516a3ecc" data-file="after_Controller.ts" layout="fixed-height" height="100"></amp-gist>

Three layers use the upper four layers. If we run the test in this state

<figure class="figure-image figure-image-fotolife" title="src/clean_architecture.test.ts &gt; architecture &gt; Check dependency #Failed">[f:id:silverbirder180:20201128115543p:plain]<figcaption>src/clean_architecture.test.ts &gt; architecture &gt; Check dependency #Failed</figcaption></figure>


It turned out to be Failed. This means that dependency errors can be detected automatically.

# Finally

The larger the project, the more complex the dependencies tend to be. Even if you have properly designed the dependencies of packages and classes (in Java), someone may break them. It would be a shame to have them broken after all the effort you put into designing them, so let's protect them with test code!
